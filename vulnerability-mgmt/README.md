# Vulnerability Management

Comprehensive vulnerability management toolkit implementing continuous scanning, risk-based prioritization, SBOM generation, and remediation tracking following 2025 best practices.

## Overview

This toolkit provides automated vulnerability management workflows including:
- **Vulnerability Scanning**: OpenVAS, Nmap NSE, Trivy container scanning
- **SBOM Generation**: CycloneDX and SPDX format compliance with CISA 2025 minimum elements
- **Risk-Based Prioritization**: Multi-factor scoring (CVSS + exploitability + asset criticality + environment)
- **Threat Intel Enrichment**: CISA KEV catalog, NVD, exploit availability checks
- **Automated Reporting**: HTML, PDF, Markdown, JSON formats
- **Remediation Tracking**: Patch management and ticket integration

## Quick Start

### Vulnerability Scanning

```bash
# OpenVAS scan
python scanners/openvas-scan.py --target 192.168.1.0/24 --output scans/ --wait

# Nmap vulnerability scan
python scanners/nmap-vuln-scan.py --target 192.168.1.100 --output scans/

# Container scanning with Trivy
python scanners/container-scan.py --image nginx:latest --severity CRITICAL,HIGH --output scans/

# Generate SBOM
python scanners/sbom-generator.py --image myapp:1.0 --output sboms/ --analyze --validate-cisa
```

### Risk-Based Prioritization

```bash
# Score vulnerabilities with risk-based prioritization
python prioritization/risk-scorer.py \
    --vulnerabilities scan_results.json \
    --asset-criticality critical \
    --environment production \
    --kev-check \
    --report \
    --output scored_vulns.json

# Enrich with threat intelligence
python prioritization/threat-intel-enrichment.py \
    --vulnerabilities vulns.json \
    --output enriched_vulns.json
```

### Report Generation

```bash
# Generate HTML report
python reporting/generate-report.py \
    --vulnerabilities scored_vulns.json \
    --format html \
    --output report.html

# Generate Markdown report
python reporting/generate-report.py \
    --vulnerabilities scored_vulns.json \
    --format markdown \
    --output VULNERABILITIES.md
```

## Directory Structure

```
vulnerability-mgmt/
├── scanners/                  # Vulnerability scanners
│   ├── openvas-scan.py             # OpenVAS/GVM integration
│   ├── nmap-vuln-scan.py           # Nmap NSE vulnerability scanning
│   ├── container-scan.py           # Trivy container scanning
│   └── sbom-generator.py           # SBOM generation (syft)
├── prioritization/            # Risk scoring and prioritization
│   ├── risk-scorer.py              # Multi-factor risk scoring
│   └── threat-intel-enrichment.py  # Threat intelligence enrichment
├── reporting/                 # Report generation
│   ├── generate-report.py          # HTML/Markdown/PDF reports
│   ├── metrics-dashboard.py        # Vulnerability metrics
│   └── compliance-mapper.py        # Compliance framework mapping
└── remediation/               # Remediation tracking
    ├── patch-tracker.py            # Patch deployment tracking
    └── ticket-integration.py       # Jira/ServiceNow integration
```

## Tool Documentation

### Scanners

#### openvas-scan.py

OpenVAS/GVM integration for comprehensive vulnerability scanning.

**Features**:
- Full vulnerability scanning with OpenVAS
- Multiple scan configurations (quick, full, discovery)
- Automated target and task creation
- Wait for completion or background scanning
- JSON, XML, PDF, HTML report formats

**Requirements**:
- OpenVAS/GVM server installed and accessible
- python-gvm (`pip install python-gvm`)

**Configuration**:
```bash
export GVM_HOST="/run/gvmd/gvmd.sock"  # Unix socket or "hostname:port"
export GVM_USERNAME="admin"
export GVM_PASSWORD="your_password"
```

**Examples**:
```bash
# Quick scan
python openvas-scan.py --target 10.0.0.5 --scan-type quick --wait --output scans/

# Full scan of network
python openvas-scan.py --target 192.168.1.0/24 --scan-type full --wait --output scans/

# Remote GVM server
python openvas-scan.py --host gvm.example.com:9390 --credentials admin:password --target webserver.local --output scans/
```

#### nmap-vuln-scan.py

Nmap NSE (Nmap Scripting Engine) vulnerability scanner.

**Features**:
- Automated NSE vulnerability script execution
- CVE extraction from scan results
- Severity estimation
- JSON and text report generation

**NSE Scripts Used**:
- Quick mode: `vuln,exploit`
- Full mode: `vuln,exploit,discovery,auth,brute`

**Examples**:
```bash
# Quick vulnerability scan
python nmap-vuln-scan.py --target 192.168.1.50 --quick --output scans/

# Full scan with specific ports
python nmap-vuln-scan.py --target webserver.local --ports 80,443,8080 --output scans/

# Scan from target file
python nmap-vuln-scan.py --target-file hosts.txt --output scans/
```

#### container-scan.py

Container and image vulnerability scanning using Trivy.

**Features**:
- Docker image scanning
- Filesystem scanning (IaC, secrets, misconfigurations)
- Severity filtering
- SBOM-aware vulnerability detection

**Examples**:
```bash
# Scan Docker image
python container-scan.py --image nginx:1.21 --severity HIGH,CRITICAL --report --output scans/

# Scan local image
python container-scan.py --image myapp:latest --output scans/

# Scan filesystem for vulnerabilities and secrets
python container-scan.py --filesystem /app --output scans/
```

#### sbom-generator.py

SBOM (Software Bill of Materials) generator using syft, compliant with CISA 2025 minimum elements.

**Features**:
- CycloneDX and SPDX format support
- Container image and filesystem scanning
- Automatic SBOM analysis
- CISA 2025 compliance validation
- License tracking

**CISA 2025 Minimum Elements**:
- Supplier Name
- Component Name
- Version
- Unique Identifier (PURL)
- Dependency Relationships
- Author of SBOM Data
- Timestamp

**Examples**:
```bash
# Generate CycloneDX SBOM for image
python sbom-generator.py --image nginx:latest --output sboms/

# Generate SPDX SBOM for directory
python sbom-generator.py --directory /app --format spdx-json --output sboms/

# Generate and analyze SBOM, validate CISA compliance
python sbom-generator.py --image myapp:1.0 --analyze --validate-cisa --output sboms/
```

### Prioritization Engine

#### risk-scorer.py

Multi-factor risk-based vulnerability scoring engine.

**Scoring Factors**:
1. **CVSS Base Score** (40% weight) - Industry-standard severity
2. **Exploitability** (30% weight) - KEV catalog, public exploits, EPSS
3. **Asset Criticality** (20% weight) - Business impact
4. **Environmental Factors** (5% weight) - Production vs dev/staging
5. **Threat Intelligence** (5% weight) - Vulnerability age, threat actor activity

**Risk Score**: 0-10 scale
- **Critical** (9.0-10.0): Immediate action required
- **High** (7.0-8.9): Remediate within 7 days
- **Medium** (4.0-6.9): Remediate within 30 days
- **Low** (0-3.9): Remediate within 90 days

**Examples**:
```bash
# Score production critical asset
python risk-scorer.py \
    --vulnerabilities scan_results.json \
    --asset-criticality critical \
    --environment production \
    --kev-check \
    --report \
    --output prioritized.json

# Score development environment
python risk-scorer.py \
    --vulnerabilities vulns.json \
    --asset-criticality medium \
    --environment development \
    --output scored.json
```

#### threat-intel-enrichment.py

Enriches vulnerability data with threat intelligence from multiple sources.

**Data Sources**:
- **CISA KEV Catalog**: Known exploited vulnerabilities
- **NVD**: National Vulnerability Database (CVE details, CVSS)
- **Exploit Detection**: Public exploit availability (Exploit-DB, Metasploit, GitHub POCs)

**Enrichment Fields**:
- KEV status and due dates
- Ransomware campaign usage
- Public exploit availability
- NVD references and descriptions
- CVSS v2/v3 scores

**Examples**:
```bash
# Enrich vulnerability list
python threat-intel-enrichment.py --vulnerabilities vulns.json --output enriched.json

# Enrich single CVE
python threat-intel-enrichment.py --cve CVE-2021-44228 --output log4shell_intel.json
```

### Reporting

#### generate-report.py

Professional vulnerability report generation.

**Report Formats**:
- **HTML**: Interactive web report with styling
- **Markdown**: Documentation-friendly format
- **JSON**: Machine-readable structured data

**Report Sections**:
- Executive summary
- Priority distribution
- Top vulnerabilities (by risk score)
- Detailed findings with risk factors
- Remediation recommendations

**Examples**:
```bash
# Generate HTML report
python generate-report.py --vulnerabilities scored_vulns.json --format html --output report.html

# Generate Markdown for documentation
python generate-report.py --vulnerabilities scored_vulns.json --format markdown --output VULNERABILITIES.md
```

## Vulnerability Management Workflow

### Complete Workflow Example

```bash
# 1. SCAN: Run vulnerability scans
python scanners/openvas-scan.py --target 192.168.1.0/24 --output scans/ --wait
python scanners/container-scan.py --image myapp:1.0 --output scans/

# 2. GENERATE SBOM
python scanners/sbom-generator.py --image myapp:1.0 --validate-cisa --analyze --output sboms/

# 3. ENRICH: Add threat intelligence
python prioritization/threat-intel-enrichment.py --vulnerabilities scans/results.json --output enriched.json

# 4. PRIORITIZE: Risk-based scoring
python prioritization/risk-scorer.py \
    --vulnerabilities enriched.json \
    --asset-criticality critical \
    --environment production \
    --kev-check \
    --report \
    --output prioritized.json

# 5. REPORT: Generate reports
python reporting/generate-report.py --vulnerabilities prioritized.json --format html --output report.html

# 6. REMEDIATE: Track and patch (manual or automated)
# - Review prioritized.json for action items
# - Patch critical/high findings first
# - Re-scan to verify fixes
```

### Continuous Vulnerability Management

**Daily**:
- Automated scans of new deployments
- SBOM generation for new containers
- KEV catalog checks

**Weekly**:
- Full network vulnerability scans
- Risk score recalculation
- Priority vulnerability review
- Patch verification scans

**Monthly**:
- Comprehensive reports for management
- Trend analysis
- Compliance framework mapping
- Remediation effectiveness metrics

## Best Practices

### Scanning Best Practices

1. **Authorized Scanning Only**: Always obtain proper authorization
2. **Network Impact**: Schedule scans during maintenance windows
3. **Scan Frequency**: Production weekly, Development daily
4. **Credentialed Scans**: Use credentials for authenticated scanning (more accurate)
5. **Baseline Scans**: Establish security baseline for all assets

### Prioritization Best Practices

1. **Context Matters**: Always consider asset criticality and environment
2. **KEV First**: Prioritize CISA KEV vulnerabilities immediately
3. **Exploit Availability**: Public exploits = higher priority
4. **Age Consideration**: Newer vulnerabilities may indicate active campaigns
5. **False Positive Management**: Verify findings before remediation

### Remediation Best Practices

1. **Patch Critical First**: Focus on critical/high risk scores
2. **Test Patches**: Test in non-production before production deployment
3. **Verify Fixes**: Re-scan after patching to confirm remediation
4. **Document Everything**: Maintain audit trail of remediation activities
5. **SLA Compliance**: Meet remediation SLAs by priority level

## Security Considerations

### Credentials and API Keys

- **OpenVAS**: Store credentials in environment variables
- **NVD API**: No authentication required (rate-limited)
- **KEV Catalog**: Public HTTPS endpoint (no auth)

### Sensitive Data Handling

- Scan results may contain sensitive information (internal IPs, software versions)
- Store results securely with appropriate access controls
- Encrypt reports containing vulnerability data
- Follow data retention policies

### Network Security

- Use dedicated scanning VLANs when possible
- Implement network segmentation
- Monitor for scanning impact on production systems
- Use rate limiting for automated scans

## Compliance and Standards

### CISA Guidelines

This toolkit aligns with:
- **CISA 2025 SBOM Minimum Elements**: Full compliance for SBOM generation
- **CISA Binding Operational Directive 22-01**: KEV catalog integration
- **NIST Cybersecurity Framework**: Continuous monitoring and assessment

### Compliance Frameworks

Vulnerability management supports:
- **PCI-DSS**: Quarterly vulnerability scans (Requirement 11.2)
- **ISO 27001**: Information security risk assessment (A.12.6.1)
- **NIST 800-53**: Vulnerability scanning (RA-5)
- **CIS Controls**: Continuous vulnerability management (Control 7)

## Troubleshooting

### OpenVAS Issues

**Problem**: Cannot connect to GVM socket
```bash
# Check if gvmd is running
sudo systemctl status gvmd

# Verify socket path
ls -la /run/gvmd/gvmd.sock

# Check permissions
sudo chmod 660 /run/gvmd/gvmd.sock
```

**Problem**: Authentication failed
```bash
# Reset admin password
sudo gvmd --user=admin --new-password=newpassword
```

### Nmap Issues

**Problem**: Permission denied
```bash
# Run with sudo for raw socket access
sudo python nmap-vuln-scan.py --target 192.168.1.100 --output scans/
```

### Trivy Issues

**Problem**: Rate limit exceeded
```bash
# Use local vulnerability database
trivy image --download-db-only
python container-scan.py --image nginx:latest --output scans/
```

### Syft Issues

**Problem**: Cannot connect to registry
```bash
# Login to registry first
docker login registry.example.com
python sbom-generator.py --image registry.example.com/app:1.0 --output sboms/
```

## Performance Considerations

### Scan Duration

- **OpenVAS Full Scan**: 30 minutes - 2 hours (depends on targets)
- **Nmap Quick Scan**: 5-15 minutes
- **Trivy Container Scan**: 1-5 minutes
- **SBOM Generation**: 30 seconds - 3 minutes

### Resource Requirements

**Minimum**:
- CPU: 4 cores
- RAM: 8GB
- Disk: 50GB free space

**Recommended**:
- CPU: 8+ cores
- RAM: 16GB+
- Disk: 200GB+ SSD
- Network: Dedicated scanning VLAN

## Additional Resources

### Documentation
- OpenVAS/GVM: https://greenbone.github.io/docs/
- Nmap NSE: https://nmap.org/nsedoc/
- Trivy: https://aquasecurity.github.io/trivy/
- Syft: https://github.com/anchore/syft
- CISA KEV: https://www.cisa.gov/known-exploited-vulnerabilities-catalog
- NVD: https://nvd.nist.gov/

### Standards
- CISA 2025 SBOM Elements: https://www.cisa.gov/sbom
- CVSS v3.1: https://www.first.org/cvss/
- CycloneDX: https://cyclonedx.org/
- SPDX: https://spdx.dev/

## Contributing

When contributing vulnerability management tools:
1. Follow defensive security principles
2. Test with sample data before production use
3. Include comprehensive help text and examples
4. Document API dependencies and rate limits
5. Add error handling and logging
6. Update this README with new tools

## Security Notice

**Authorized Use Only**:
- Vulnerability scanning must be authorized by asset owners
- Obtain written permission before scanning external targets
- Follow responsible disclosure for discovered vulnerabilities
- Comply with local and international laws regarding security testing

---

**Last Updated**: 2025-10-15
**Maintainer**: Defensive Toolkit
**License**: MIT
