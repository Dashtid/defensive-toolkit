title: DNS Tunneling Exfiltration Detection
id: 33334444-1111-cccc-1111-111111111111
status: stable
description: |
    Detects DNS tunneling used for data exfiltration. Attackers encode data
    in DNS queries and responses to bypass network security controls.
    Common tools include dnscat2, iodine, and custom implementations.
references:
    - https://attack.mitre.org/techniques/T1048/003/
    - https://attack.mitre.org/techniques/T1071/004/
    - https://www.akamai.com/blog/security/dns-exfiltration-malware-dont-let-attackers-tunnel-out
author: Defensive Toolkit
date: 2025-11-26
modified: 2025-11-26
tags:
    - attack.exfiltration
    - attack.command_and_control
    - attack.t1048.003
    - attack.t1071.004
    - detection.emerging_threats
logsource:
    category: process_creation
    product: windows
detection:
    selection_dns_tunnel_tools:
        Image|endswith:
            - '\dnscat2.exe'
            - '\iodine.exe'
            - '\dns2tcp.exe'
            - '\dnscat.exe'
    selection_nslookup_suspicious:
        Image|endswith: '\nslookup.exe'
        CommandLine|re: '[a-zA-Z0-9]{30,}\.'
    selection_powershell_dns:
        Image|endswith:
            - '\powershell.exe'
            - '\pwsh.exe'
        CommandLine|contains:
            - 'Resolve-DnsName'
            - '[System.Net.Dns]::GetHostAddresses'
            - 'Invoke-DNSExfiltration'
            - 'ConvertTo-Base64'
            - 'TXT '
    selection_high_frequency:
        Image|endswith: '\nslookup.exe'
        CommandLine|contains:
            - '-type=TXT'
            - '-type=CNAME'
            - '-type=MX'
            - '-querytype='
    condition: selection_dns_tunnel_tools or selection_nslookup_suspicious or selection_powershell_dns
falsepositives:
    - Legitimate DNS debugging
    - DNS-based service discovery
    - DKIM/SPF verification tools
level: high
