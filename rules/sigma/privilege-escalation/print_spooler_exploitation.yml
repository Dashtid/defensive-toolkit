title: Print Spooler Exploitation - PrintNightmare and Related
id: c1b2c3d4-3333-6666-cccc-333333333333
status: stable
description: |
    Detects exploitation attempts against the Windows Print Spooler service,
    including PrintNightmare (CVE-2021-34527, CVE-2021-1675) and related
    vulnerabilities. These allow remote code execution and privilege escalation.
references:
    - https://attack.mitre.org/techniques/T1068/
    - https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-34527
    - https://github.com/cube0x0/CVE-2021-1675
author: Defensive Toolkit
date: 2025-11-26
modified: 2025-11-26
tags:
    - attack.privilege_escalation
    - attack.t1068
    - cve.2021.34527
    - cve.2021.1675
    - detection.emerging_threats
logsource:
    category: process_creation
    product: windows
detection:
    selection_spoolsv_child:
        ParentImage|endswith: '\spoolsv.exe'
        Image|endswith:
            - '\cmd.exe'
            - '\powershell.exe'
            - '\pwsh.exe'
            - '\rundll32.exe'
            - '\net.exe'
            - '\net1.exe'
    selection_suspicious_dll:
        Image|endswith: '\rundll32.exe'
        CommandLine|contains:
            - '\spool\drivers\'
            - 'AddPrinterDriverEx'
    selection_print_exploit_tools:
        CommandLine|contains:
            - 'CVE-2021-1675'
            - 'CVE-2021-34527'
            - 'PrintNightmare'
            - 'SharpPrintNightmare'
            - 'Invoke-Nightmare'
    condition: 1 of selection_*
falsepositives:
    - Legitimate printer driver installations (rare to spawn cmd/powershell)
level: critical
---
title: Print Spooler Service Exploitation via Registry
id: c1b2c3d4-3333-6666-cccc-333333333334
status: stable
description: |
    Detects registry modifications associated with Print Spooler exploitation,
    including disabling Point and Print restrictions.
references:
    - https://attack.mitre.org/techniques/T1068/
    - https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-34527
author: Defensive Toolkit
date: 2025-11-26
modified: 2025-11-26
tags:
    - attack.privilege_escalation
    - attack.defense_evasion
    - attack.t1068
    - attack.t1112
logsource:
    category: registry_set
    product: windows
detection:
    selection_point_and_print:
        TargetObject|contains:
            - '\Policies\Microsoft\Windows NT\Printers\PointAndPrint'
        TargetObject|endswith:
            - '\NoWarningNoElevationOnInstall'
            - '\UpdatePromptSettings'
            - '\RestrictDriverInstallationToAdministrators'
        Details: 'DWORD (0x00000001)'
    condition: selection_point_and_print
falsepositives:
    - Legitimate GPO configurations for printer management
level: high
