title: Access Token Manipulation Detection
id: c1b2c3d4-1111-6666-cccc-111111111111
status: stable
description: |
    Detects access token manipulation techniques used for privilege escalation.
    Attackers may manipulate access tokens to operate under a different user
    or system security context to perform actions and bypass access controls.
references:
    - https://attack.mitre.org/techniques/T1134/
    - https://www.elastic.co/guide/en/security/current/token-manipulation.html
    - https://pentestlab.blog/2017/04/03/token-manipulation/
author: Defensive Toolkit
date: 2025-11-26
modified: 2025-11-26
tags:
    - attack.privilege_escalation
    - attack.defense_evasion
    - attack.t1134
    - detection.emerging_threats
logsource:
    category: process_creation
    product: windows
detection:
    selection_token_tools:
        Image|endswith:
            - '\incognito.exe'
            - '\tokenvator.exe'
    selection_powershell_token:
        Image|endswith:
            - '\powershell.exe'
            - '\pwsh.exe'
        CommandLine|contains:
            - 'Invoke-TokenManipulation'
            - 'Get-System'
            - 'ImpersonateLoggedOnUser'
            - 'DuplicateTokenEx'
            - 'SetThreadToken'
            - 'AdjustTokenPrivileges'
            - 'NtImpersonateThread'
    selection_suspicious_api:
        CommandLine|contains:
            - 'OpenProcessToken'
            - 'DuplicateToken'
            - 'CreateProcessAsUser'
            - 'CreateProcessWithToken'
            - 'ImpersonateNamedPipeClient'
    condition: 1 of selection_*
falsepositives:
    - Legitimate administrative tools that manage tokens
    - Security testing and penetration testing
level: high
